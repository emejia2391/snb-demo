{% extends 'base.html' %}
{% block content %}
<style>select.input option{background:#14532d;color:#fff}</style>

<div class="card-usuarios" style="max-width:1200px;margin:28px auto;">
  <h2>{{ area and 'Editar área social' or 'Nueva área social' }}</h2>

  <form method="post" class="usuarios-form" style="padding:12px 12px 18px;">
    <!-- GRID DEL FORM -->
    <div style="display:grid;grid-template-columns:repeat(3,minmax(220px,1fr));gap:14px;max-width:1000px;">

      {% if area %}
      <div>
        <label class="label">ID</label>
        <input class="input" type="text" value="{{ area.id_area }}" disabled>
      </div>
      {% endif %}

      <div>
        <label class="label">Nombre</label>
        <input class="input" name="nombre" required value="{{ (area and area.nombre) or '' }}">
      </div>

      <div>
        <label class="label">Precio</label>
        <input class="input" name="precio" type="number" step="0.01" required value="{{ (area and area.precio) or '' }}">
      </div>

      <div>
        <label class="label">Horas</label>
        <input class="input" name="horas" type="number" min="1" required value="{{ (area and area.horas) or '' }}">
      </div>

      <!-- DÍAS -->
      <div style="grid-column:1/-1;">
        <label class="label">Días disponibles</label>
        <div class="horas-grid">
          {% set days = [
            ('lunes','Lunes'),
            ('martes','Martes'),
            ('miercoles','Miércoles'),
            ('jueves','Jueves'),
            ('viernes','Viernes'),
            ('sabado','Sábado'),
            ('domingo','Domingo')
          ] %}
          {% set selected = area.dias if area else [] %}
          {% for key,label in days %}
          <label class="chk-item">
            <input type="checkbox" name="dias[]" value="{{ key }}"
                   {% if selected and (key in selected) %}checked{% endif %}>
            <span>{{ label }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- HORAS DE INICIO (MÚLTIPLES) -->
      <div style="grid-column:1/-1;">
        <label class="label">Hora de inicio</label>
        {# Normalizamos horas_inicio a strings HH:MM para preseleccionar correctamente #}
        {% set ns = namespace(hini=[]) %}
        {% for t in (area.horas_inicio if area else []) or [] %}
          {% set s = (t if t is string else t.strftime('%H:%M')) %}
          {% set _ = ns.hini.append(s) %}
        {% endfor %}
        <div class="horas-grid">
          {% for h in range(0,24) %}
            {% set hh = "%02d:00"|format(h) %}
            <label class="chk-item">
              <input type="checkbox" name="horas_inicio" value="{{ hh }}" {% if hh in ns.hini %}checked{% endif %}>
              <span>{{ hh }}</span>
            </label>
          {% endfor %}
        </div>
        <small class="muted">Selecciona una o varias horas válidas para iniciar las reservaciones.</small>
      </div>

      <!-- HORAS DISPONIBLES -->
      <div style="grid-column:1/-1;">
        <label class="label">Horas disponibles</label>
        {% set sel = namespace(vals=[]) %}
        {% if area and area.horarios %}
          {% for t in area.horarios %}
            {% set _ = sel.vals.append(t.strftime('%H:%M')) %}
          {% endfor %}
        {% endif %}
        <div class="horas-grid">
          {% for h in range(0,24) %}
            {% set hh = "%02d:00"|format(h) %}
            <label class="chk-item">
              <input type="checkbox" name="horarios[]" value="{{ hh }}" {% if hh in sel.vals %}checked{% endif %}>
              <span>{{ hh }}</span>
            </label>
          {% endfor %}
        </div>
      </div>

      <!-- ESTADO -->
      <div style="grid-column:1/-1;">
        <label class="label">Estado</label>
        <select class="input" name="estado">
          {% set st = area.estado if area is not none else 1 %}
          <option value="1" {% if st==1 %}selected{% endif %}>Habilitado</option>
          <option value="0" {% if st==0 %}selected{% endif %}>Deshabilitado</option>
        </select>
      </div>

      <!-- ACCIONES DENTRO DEL CUADRO -->
      <div style="grid-column:1/-1;display:flex;gap:12px;margin-top:10px;">
        <button class="btn btn-primary" type="submit">Guardar</button>
        <a class="btn" href="{{ url_for('areas_sociales_list') }}">Cancelar</a>
      </div>

    </div><!-- /grid -->
  </form>
</div>
{% endblock %}
